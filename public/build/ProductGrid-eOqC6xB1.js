import{j as e,V as F,r as c}from"./app-DlvoDJJo.js";import{u as B}from"./Layout-CKb6mCT8.js";import{D as G,a as V,b as J,c as K,A as U,d as W}from"./alert-B7bscsUx.js";import{C as D}from"./chevron-left-DiZTRhl0.js";import{C as z}from"./chevron-right-DuWMSwET.js";import{c as $}from"./createLucideIcon-Cvfh0g26.js";import{S as q,H as M}from"./user-CmaB7S3S.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=$("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=$("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),A=({price:s,salePrice:o})=>o?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-300 line-through",children:["$",s.toLocaleString()]}),e.jsxs("span",{className:"text-red-400 font-semibold",children:["$",o.toLocaleString()]})]}):e.jsxs("span",{className:"text-gray-100",children:["$",s.toLocaleString()]}),Z=()=>e.jsx("span",{className:"absolute top-4 left-4 px-2 py-1 text-xs font-semibold text-white bg-red-500 rounded-full",children:"Out of Stock"}),ee=({product:s,isOpen:o,onClose:x,onToggleWishlist:f,isInWishlist:h})=>{var I,P,S;const{auth:p}=F().props,[g,d]=c.useState(0),[i,m]=c.useState(null),[l,r]=c.useState(null),[u,j]=c.useState(1),[_,k]=c.useState(!1),[C,b]=c.useState(null),{addToCart:L}=B();c.useEffect(()=>{o&&(m(null),r(null),b(null),j(1),d(0))},[o,s]);const y=c.useMemo(()=>{const a=new Map;return s!=null&&s.variants&&s.variants.forEach(t=>{a.has(t.size_id)||a.set(t.size_id,new Map),a.get(t.size_id).set(t.color_id,t)}),a},[s==null?void 0:s.variants]),w=(a,t)=>{const v=y.get(a);if(!v)return!1;const N=v.get(t);return N&&N.stock_quantity>0},n=c.useMemo(()=>{if(!l||!i)return null;const a=y.get(l.size_id);return a?a.get(i.color_id):null},[l,i,y]),O=a=>{a.preventDefault(),a.stopPropagation(),d(t=>(t+1)%s.images.length)},E=a=>{a.preventDefault(),a.stopPropagation(),d(t=>(t-1+s.images.length)%s.images.length)},Q=a=>{a.preventDefault(),a.stopPropagation(),n&&u<n.stock_quantity&&j(t=>t+1)},H=a=>{a.preventDefault(),a.stopPropagation(),u>1&&j(t=>t-1)},R=a=>{const t=parseInt(a.target.value);!isNaN(t)&&t>=1&&(n&&t<=n.stock_quantity?j(t):n&&j(n.stock_quantity))},T=async()=>{if(!p.user){b("Please login to add items to cart.");return}if(!n){b("Please select both size and color before adding to cart.");return}try{k(!0),b(null);const a=await L(n.variant_id,u);a.success?x():b(a.message||"Failed to add item to cart. Please try again.")}catch{b("An error occurred while adding to cart. Please try again.")}finally{k(!1)}};return s?e.jsx(G,{open:o,onOpenChange:x,children:e.jsxs(V,{className:"max-w-3xl",children:[e.jsx(J,{children:e.jsx(K,{className:"text-2xl font-bold",children:s.name})}),C&&e.jsx(U,{variant:"destructive",className:"mt-4",children:e.jsx(W,{children:C})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-lg",style:{aspectRatio:"3/4"},children:[e.jsx("img",{src:(I=s.images[g])==null?void 0:I.image_url,alt:`${s.name} view ${g+1}`,className:"w-full h-full object-cover"}),s.images.length>1&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-between p-2",children:[e.jsx("button",{onClick:E,className:"bg-black/50 p-2 rounded-full text-white hover:bg-black/70 transition-colors",children:e.jsx(D,{className:"w-5 h-5"})}),e.jsx("button",{onClick:O,className:"bg-black/50 p-2 rounded-full text-white hover:bg-black/70 transition-colors",children:e.jsx(z,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"mt-4 flex gap-2 overflow-x-auto",children:s.images.map((a,t)=>e.jsx("button",{onClick:()=>d(t),className:`flex-shrink-0 w-20 h-24 rounded-lg overflow-hidden ${g===t?"ring-2 ring-blue-500":""}`,children:e.jsx("img",{src:a.image_url,alt:`${s.name} thumbnail ${t+1}`,className:"w-full h-full object-cover"})},a.image_id))})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"mb-4",children:e.jsx(A,{price:(n==null?void 0:n.price)||s.price,salePrice:(n==null?void 0:n.sale_price)||s.sale_price})}),e.jsx("p",{className:"text-gray-600 mb-6",children:s.description}),s.material&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Material"}),e.jsx("p",{className:"text-gray-600",children:s.material.name}),s.material.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s.material.description})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Select Size"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(P=s.available_sizes)==null?void 0:P.map(a=>e.jsx("button",{onClick:()=>{r(a),i&&!w(a.size_id,i.color_id)&&m(null)},className:`px-4 py-2 border rounded-md transition-colors ${(l==null?void 0:l.size_id)===a.size_id?"border-blue-500 bg-blue-50":"hover:border-blue-500"}`,children:a.name},a.size_id))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Select Color"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(S=s.available_colors)==null?void 0:S.map(a=>{var v;const t=l?w(l.size_id,a.color_id):(v=s.variants)==null?void 0:v.some(N=>N.color_id===a.color_id&&N.stock_quantity>0);return e.jsxs("button",{onClick:()=>{t&&m(a)},disabled:!t,className:`group relative p-1 rounded-full ${(i==null?void 0:i.color_id)===a.color_id?"ring-2 ring-blue-500":""} ${t?"":"opacity-50 cursor-not-allowed"}`,title:`${a.name}${l&&w(l.size_id,a.color_id)?` - ${y.get(l.size_id).get(a.color_id).stock_quantity} in stock`:t?"":" - Not available for selected size"}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full border",style:{backgroundColor:a.description}}),e.jsx("span",{className:"absolute inset-0 rounded-full group-hover:bg-black/10"})]},a.color_id)})})]}),n&&e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[n.stock_quantity," units available"]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Quantity:"}),e.jsxs("div",{className:"flex items-center border rounded-lg",children:[e.jsx("button",{type:"button",onClick:H,disabled:u<=1,className:"p-2 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(X,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",min:"1",max:n.stock_quantity,value:u,onChange:R,className:"w-16 text-center border-x p-2"}),e.jsx("button",{type:"button",onClick:Q,disabled:u>=n.stock_quantity,className:"p-2 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Y,{className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{className:"mt-auto pt-6 flex gap-4",children:[e.jsxs("button",{type:"button",className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!n||n.stock_quantity<=0||_,onClick:T,children:[e.jsx(q,{className:"w-5 h-5"}),_?"Adding...":n?n.stock_quantity<=0?"Out of Stock":"Add to Cart":"Select Options"]}),e.jsx("button",{type:"button",onClick:()=>f(s.product_id),className:"p-2 rounded-lg border hover:bg-gray-50",children:e.jsx(M,{className:`w-5 h-5 ${h?"fill-red-500 text-red-500":"text-gray-600"}`})})]})]})]})]})}):null},se=({product:s,onToggleWishlist:o,isInWishlist:x})=>{var m;const[f,h]=c.useState(0),[p,g]=c.useState(!1),d=l=>{l.preventDefault(),l.stopPropagation(),h(r=>r===0?s.images.length-1:r-1)},i=l=>{l.preventDefault(),l.stopPropagation(),h(r=>r===s.images.length-1?0:r+1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden hover:shadow-lg transition-shadow group relative cursor-pointer",onClick:()=>g(!0),children:[e.jsx("div",{className:"relative w-full pt-[133%]",children:e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("img",{src:((m=s.images[f])==null?void 0:m.image_url)||"/path/to/fallback.jpg",alt:s.name,className:"w-full h-full object-cover"}),s.images.length>1&&e.jsxs("div",{className:"absolute inset-y-0 w-full flex items-center justify-between px-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:d,className:"bg-black/50 p-1 rounded-full text-white hover:bg-black/70 transition-colors",children:e.jsx(D,{className:"w-6 h-6"})}),e.jsx("button",{onClick:i,className:"bg-black/50 p-1 rounded-full text-white hover:bg-black/70 transition-colors",children:e.jsx(z,{className:"w-6 h-6"})})]}),e.jsx("button",{onClick:l=>{l.preventDefault(),l.stopPropagation(),o()},className:"absolute top-2 right-2 p-2 rounded-full bg-white/80 hover:bg-white transition-colors",children:e.jsx(M,{className:`w-5 h-5 ${x?"fill-red-500 text-red-500":"text-gray-600"}`})})]})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black/40 backdrop-blur-sm p-4 text-white",children:[e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-lg font-medium truncate max-w-full sm:text-base md:text-lg lg:text-xl",children:s.name}),e.jsx(A,{price:s.price,salePrice:s.sale_price})]}),e.jsx("button",{onClick:l=>{l.preventDefault(),l.stopPropagation()},className:"flex-shrink-0 bg-white/20 hover:bg-white/30 p-2 rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:s.stock_quantity<=0,children:e.jsx(q,{className:"w-6 h-6 text-white"})})]}),s.stock_quantity<=0&&e.jsx(Z,{})]})]}),e.jsx(ee,{product:s,isOpen:p,onClose:()=>g(!1),onToggleWishlist:o,isInWishlist:x})]})},ce=({products:s=[],currentImageIndexes:o={},onPrevImage:x,onNextImage:f,onToggleWishlist:h,wishlist:p=[]})=>{const d=((i,m)=>{const l={...m};return i.forEach(r=>{r!=null&&r.product_id&&!(r.product_id in l)&&(l[r.product_id]=0)}),l})(s,o);return e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:s.filter(i=>i&&i.product_id).map(i=>e.jsx(se,{product:i,currentImageIndex:d[i.product_id],onPrevImage:()=>x(i.product_id),onNextImage:()=>f(i.product_id),onToggleWishlist:()=>h(i.product_id),isInWishlist:p.includes(i.product_id)},i.product_id))})};export{ce as P};
